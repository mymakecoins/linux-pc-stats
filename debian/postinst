#!/bin/sh
set -e
# Byte-compile Python para desempenho (opcional)
if command -v py3compile >/dev/null 2>&1; then
    py3compile /usr/share/linux-stats/project/src 2>/dev/null || true
fi

# Detectar ambiente de desktop (por pacotes instalados; sem TTY não perguntamos)
DETECT="/usr/share/linux-stats/scripts/detect-desktop.sh"
DE=""
if [ -x "$DETECT" ]; then
    OUTPUT="$("$DETECT" --no-ask --instructions 2>&1)"
    DE=$(echo "$OUTPUT" | tail -1)
fi

echo ""
echo "linux-stats instalado. Comandos úteis:"
echo "  • Executar: linux-stats-statusbar"
echo "  • Na primeira execução será criado ~/.config/linux-stats/config.json (a partir do exemplo)."
echo "  • Para exibir na barra do sistema (próximo ao relógio e ícones):"
if [ -n "$OUTPUT" ]; then
    echo "$OUTPUT" | head -n -1
    if [ "$DE" = "OUTRO" ] || [ -z "$DE" ]; then
        echo "    Execute: linux-stats-setup-bar (para escolher o ambiente e ver instruções)"
    fi
else
    echo "    Execute: linux-stats-setup-bar (identifica ou pergunta o ambiente e mostra instruções)"
fi
echo "  Documentação: /usr/share/doc/linux-stats/INTEGRACAO_BARRA_STATUS.md"
echo ""
exit 0
